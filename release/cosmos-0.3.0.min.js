!function(t,e){"function"==typeof define&&define.amd?define(["react","lodash","jquery"],e):"object"==typeof exports?module.exports=e(require("react/addons"),require("lodash"),require("jquery")):t.Cosmos=e(t.React,t._,t.$)}(this,function(t,e,n){var i=function(t){return i.createElement(t)};e.extend(i,{mixins:{},components:{},transitions:{},start:function(t,e){return new this.Router(t,e)},render:function(e,n,i){var o=this.createElement(e);return n?t.render(o,n,i):t.renderToString(o)},createElement:function(n){var i=this.getComponentByName(n.component,n.componentLookup);if(!e.isFunction(i))throw new Error("Invalid component: "+n.component);return t.createElement(i,n)},getComponentByName:function(t,n){if(e.isFunction(n)){var i=n(t);if(i)return i}return this.components[t]}}),i.Router=function(t,n){this._defaultProps=t||{},this._options=e.extend({container:document.body},n),this.onPopState=this.onPopState.bind(this),this._bindPopStateEvent(),this._load(i.url.getParams(),window.location.href)},e.extend(i.Router,{prototype:{stop:function(){this._unbindPopStateEvent()},goTo:function(t){if(!i.url.isPushStateSupported())return void(window.location=t);if(this.rootComponent){var e=this.rootComponent.generateSnapshot();this._replaceHistoryState(this._excludeDefaultProps(e),this._currentHref)}var n=t.split("?").pop(),o=i.serialize.getPropsFromQueryString(n),r=this;this._load(o,t,function(){var e=this.generateSnapshot();r._pushHistoryState(r._excludeDefaultProps(e),t)})},onPopState:function(t){t.state&&this._load(t.state,window.location.href)},_load:function(t,n,o){var r=e.extend({router:this},this._defaultProps,t);this.rootComponent=i.render(r,this._options.container,o),this._currentHref=n,e.isFunction(this._options.onChange)&&this._options.onChange.call(this,t)},_bindPopStateEvent:function(){window.addEventListener("popstate",this.onPopState)},_unbindPopStateEvent:function(){window.removeEventListener("popstate",this.onPopState)},_replaceHistoryState:function(t,e){window.history.replaceState(t,"",e)},_pushHistoryState:function(t,e){window.history.pushState(t,"",e)},_excludeDefaultProps:function(t){var e,n={};for(var i in t)"router"!==i&&(e=t[i],e!==this._defaultProps[i]&&(n[i]=e));return n}}}),i.serialize={getPropsFromQueryString:function(t){var e={};if(!t.length)return e;for(var n,i,o,r=t.split("&"),s=0;s<r.length;s++){n=r[s].split("="),i=n[0],o=decodeURIComponent(n[1]);try{o=JSON.parse(o)}catch(a){}e[i]=o}return e},getQueryStringFromProps:function(t){var e,n=[];for(var i in t){if(e=t[i],"object"==typeof e)try{e=JSON.stringify(e)}catch(o){continue}n.push(i+"="+encodeURIComponent(e))}return n.join("&")}},i.url={getParams:function(){return i.serialize.getPropsFromQueryString(window.location.search.substr(1))},isPushStateSupported:function(){return!!window.history.pushState}},function(t,e){t.mixins.AnimationLoop={startAnimationLoop:function(){this._clearAnimation(),this._nextFrame(),this.setState({animationLoopRunning:!0})},stopAnimationLoop:function(){this._clearAnimation(),this.setState({animationLoopRunning:!1})},componentDidMount:function(){this._loadAnimationState(this.state)},componentWillReceiveProps:function(t){t.state&&this._loadAnimationState(t.state)},componentWillUnmount:function(){this._clearAnimation()},_loadAnimationState:function(t){t&&void 0!==t.animationLoopRunning&&(t.animationLoopRunning?this.startAnimationLoop():this.stopAnimationLoop())},_nextFrame:function(){this._prevTime=Date.now(),this._animationRequestId=n(this._animationCallback)},_clearAnimation:function(){this._animationRequestId&&(i(this._animationRequestId),this._animationRequestId=null)},_animationCallback:function(){if("function"==typeof this.onFrame){var t=Date.now(),e=t-this._prevTime,n=1e3/60;this.onFrame(e/n),this._animationRequestId&&this._nextFrame()}}};var n=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||function(t){return e.setTimeout(t,1e3/60)},i=e.cancelAnimationFrame||e.webkitCancelAnimationFrame||e.mozCancelAnimationFrame||function(t){e.clearTimeout(t)}}(i,this),i.mixins.ClassName={getClassName:function(t){return void 0!==this.props.className?this.props.className:t}},i.mixins.DataFetch={fetchDataFromServer:function(t,i){this.setState({isFetchingData:!0});var o=n.ajax({url:t,type:"GET",dataType:"json",complete:function(){this.xhrRequests=e.without(this.xhrRequests,o)}.bind(this),success:i,error:function(e,n,i){this._ignoreXhrRequestCallbacks||(this.setState({isFetchingData:!1}),console.error(t,n,i.toString()))}.bind(this)});this.xhrRequests.push(o)},receiveDataFromServer:function(t){this.setState({isFetchingData:!1,data:t})},_resetData:function(t){var e="function"==typeof this.getDataUrl?this.getDataUrl(t):t.dataUrl;this.clearDataRequests(),e&&(this.fetchDataFromServer(e,this.receiveDataFromServer),t.pollInterval&&(this.pollInterval=setInterval(function(){this.fetchDataFromServer(e,this.receiveDataFromServer)}.bind(this),t.pollInterval)))},refreshData:function(){this._resetData(this.props)},clearDataRequests:function(){for(;!e.isEmpty(this.xhrRequests);)this.xhrRequests.pop().abort();this.pollInterval&&clearInterval(this.pollInterval)},getDefaultProps:function(){return{pollInterval:0}},componentWillMount:function(){this.xhrRequests=[],this._resetData(this.props)},componentWillReceiveProps:function(t){this.props.dataUrl!==t.dataUrl&&this._resetData(t)},componentWillUnmount:function(){this._ignoreXhrRequestCallbacks=!0,this.clearDataRequests()}},i.mixins.PersistState={generateSnapshot:function(t){var n,i={},o={};for(var r in this.props)n=this.props[r],"__owner__"!=r&&"state"!=r&&(i[r]=n);return i.state=e.cloneDeep(this.state)||{},t&&(e.each(this.refs,function(t,n){o[n]="function"==typeof t.generateSnapshot?t.generateSnapshot(!0).state:e.cloneDeep(t.state)||{}}),e.isEmpty(o)||(i.state.children=o)),i},loadChild:function(){var t=this.getChildProps.apply(this,arguments);if(t)try{return i.createElement(t)}catch(e){console.error(e)}return null},getChildProps:function(t){for(var e=[],n=1;n<arguments.length;++n)e[n-1]=arguments[n];var i=this.children[t].apply(this,e);return i?(i.ref||(i.ref=t),this._childSnapshots&&this._childSnapshots[t]&&(i.state=this._childSnapshots[t],delete this._childSnapshots[t]),this.props.componentLookup&&(i.componentLookup=this.props.componentLookup),i):void 0},loadStateSnapshot:function(t){t.children&&(this._childSnapshots=t.children,delete t.children),this.replaceState(e.cloneDeep(t))},componentWillMount:function(){this.props.state&&this.loadStateSnapshot(this.props.state)},componentWillReceiveProps:function(t){t.state&&this.loadStateSnapshot(t.state)}},i.mixins.Url={getUrlFromProps:function(t){return"?"+i.serialize.getQueryStringFromProps(t)},routeLink:function(t){t.preventDefault(),this.props.router.goTo(t.currentTarget.getAttribute("href"))}};var o=t.addons.classSet;return i.components.ComponentPlayground=t.createClass({mixins:[i.mixins.PersistState,i.mixins.Url],displayName:"ComponentPlayground",propTypes:{fixtures:t.PropTypes.object.isRequired,fixturePath:t.PropTypes.string,fullScreen:t.PropTypes.bool,containerClassName:t.PropTypes.string},getInitialState:function(){var t=[];return this.props.fixturePath&&t.push(this._getComponentNameFromPath(this.props.fixturePath)),{expandedComponents:t}},children:{preview:function(){var t={component:this._getComponentNameFromPath(this.props.fixturePath)};this.props.router&&(t.router=this.props.router);var n=this._getFixtureContentsFromPath(this.props.fixturePath);return e.extend(t,n)}},render:function(){var e=o({"component-playground":!0,"full-screen":this.props.fullScreen});return t.createElement("div",{className:e},t.createElement("div",{className:"header"},this.renderFullScreenButton(),t.createElement("h1",null,t.createElement("a",{href:"?",onClick:this.routeLink},t.createElement("span",{className:"react"},"React")," Component Playground"))),t.createElement("div",{className:"fixtures"},this.renderFixtures()),t.createElement("div",{ref:"preview",className:this._getPreviewClasses()},this.props.fixturePath?this.loadChild("preview"):null))},renderFixtures:function(){return t.createElement("ul",{className:"components"},e.map(this.props.fixtures,function(n,i){var r=o({component:!0,expanded:-1!==this.state.expandedComponents.indexOf(i)});return t.createElement("li",{className:r,key:i},t.createElement("p",{className:"component-name"},t.createElement("a",{href:"#toggle-component",onClick:e.partial(this.handleComponentClick,i),ref:i+"Button"},i)),this.renderComponentFixtures(i,n))}.bind(this)))},renderComponentFixtures:function(n,i){return t.createElement("ul",{className:"component-fixtures"},e.map(i,function(e,i){var o=this.getUrlFromProps({fixturePath:n+"/"+i});return t.createElement("li",{className:this._getFixtureClasses(i),key:i},t.createElement("a",{href:o,onClick:this.routeLink},i.replace(/-/g," ")))}.bind(this)))},renderFullScreenButton:function(){if(this.props.fixturePath){var e=this.getUrlFromProps({fixturePath:this.props.fixturePath,fullScreen:!0});return t.createElement("a",{href:e,className:"full-screen-button",ref:"fullScreenButton"},"Fullscreen")}},handleComponentClick:function(t,n){n.preventDefault();var i,o=this.state.expandedComponents,r=o.indexOf(t);-1!==r?(i=e.clone(o),i.splice(r,1)):i=o.concat(t),this.setState({expandedComponents:i})},_getPreviewClasses:function(){var t={preview:!0};return this.props.containerClassName&&(t[this.props.containerClassName]=!0),o(t)},_getFixtureClasses:function(t){var e={"component-fixture":!0},n=this.props.fixturePath;if(n){var i=this._getFixtureNameFromPath(n);e.selected=t===i}return o(e)},_getFixtureContentsFromPath:function(t){var e=this._getComponentNameFromPath(t),n=this._getFixtureNameFromPath(t);return this.props.fixtures[e][n]},_getComponentNameFromPath:function(t){return t.split("/")[0]},_getFixtureNameFromPath:function(t){return t.substr(t.indexOf("/")+1)}}),i});