!function(t,e){"function"==typeof define&&define.amd?define(["react","lodash"],e):"object"==typeof exports?module.exports=e(require("react/addons"),require("lodash")):t.Cosmos=e(t.React,t._)}(this,function(t,e){var n=function(t){return n.createElement(t)};e.extend(n,{mixins:{},components:{},transitions:{},start:function(t,e){return new this.Router(t,e)},render:function(e,n,r){var o=this.createElement(e);return n?t.render(o,n,r):t.renderToString(o)},createElement:function(n){var r=this.getComponentByName(n.component,n.componentLookup);if(!e.isFunction(r))throw new Error("Invalid component: "+n.component);return t.createElement(r,n)},getComponentByName:function(t,n){if(e.isFunction(n)){var r=n(t);if(r)return r}return this.components[t]}}),n.Router=function(t,r){this._defaultProps=t||{},this._options=e.extend({container:document.body},r),this.onPopState=this.onPopState.bind(this),this._bindPopStateEvent(),this._load(n.url.getParams(),window.location.href)},e.extend(n.Router,{prototype:{stop:function(){this._unbindPopStateEvent()},goTo:function(t){if(!n.url.isPushStateSupported())return void(window.location=t);if(this.rootComponent){var e=this.rootComponent.serialize(!0);this._replaceHistoryState(this._excludeDefaultProps(e),this._currentHref)}var r=t.split("?").pop(),o=n.serialize.getPropsFromQueryString(r),i=this;this._load(o,t,function(){var e=this.serialize(!0);i._pushHistoryState(i._excludeDefaultProps(e),t)})},onPopState:function(t){t.state&&this._load(t.state,window.location.href)},_load:function(t,r,o){var i={router:this,key:r},s=e.extend(i,this._defaultProps,t);this.rootComponent=n.render(s,this._options.container,o),this._currentHref=r,e.isFunction(this._options.onChange)&&this._options.onChange.call(this,t)},_bindPopStateEvent:function(){window.addEventListener("popstate",this.onPopState)},_unbindPopStateEvent:function(){window.removeEventListener("popstate",this.onPopState)},_replaceHistoryState:function(t,e){window.history.replaceState(t,"",e)},_pushHistoryState:function(t,e){window.history.pushState(t,"",e)},_excludeDefaultProps:function(t){var e,n={};for(var r in t)"router"!==r&&(e=t[r],e!==this._defaultProps[r]&&(n[r]=e));return n}}}),n.serialize={getPropsFromQueryString:function(t){var e={};if(!t.length)return e;for(var n,r,o,i=t.split("&"),s=0;s<i.length;s++){n=i[s].split("="),r=n[0],o=decodeURIComponent(n[1]);try{o=JSON.parse(o)}catch(a){}e[r]=o}return e},getQueryStringFromProps:function(t){var e,n=[];for(var r in t){if(e=t[r],"object"==typeof e)try{e=JSON.stringify(e)}catch(o){continue}n.push(r+"="+encodeURIComponent(e))}return n.join("&")}},n.url={getParams:function(){return n.serialize.getPropsFromQueryString(window.location.search.substr(1))},isPushStateSupported:function(){return!!window.history.pushState}},n.mixins.ClassName={getClassName:function(t){return void 0!==this.props.className?this.props.className:t}},n.mixins.ComponentTree={serialize:function(t){var n,r=e.omit(this.props,"state"),o=e.omit(this.state,"children"),i={};return t&&(e.each(this.refs,function(t,r){e.isFunction(t.serialize)&&(n=t.serialize(!0),e.isEmpty(n.state)||(i[r]=n.state))}),e.isEmpty(i)||(o.children=i)),e.isEmpty(o)||(r.state=o),r},loadChild:function(){var t=this.getChildProps.apply(this,arguments);if(t)try{return n.createElement(t)}catch(e){console.error(e)}return null},getChildProps:function(t){for(var e=[],n=1;n<arguments.length;++n)e[n-1]=arguments[n];var r=this.children[t].apply(this,e);return r?(r.ref||(r.ref=t),this._childSnapshots&&this._childSnapshots[r.ref]&&(r.state=this._childSnapshots[r.ref]),this.props.componentLookup&&(r.componentLookup=this.props.componentLookup),r):void 0},componentWillMount:function(){this.props.state&&this._loadStateSnapshot(this.props.state)},componentDidMount:function(){this._clearChildSnapshots()},_loadStateSnapshot:function(t){t.children&&(this._childSnapshots=t.children);var n={};e.isFunction(this.getInitialState)&&e.extend(n,this.getInitialState()),this.replaceState(e.extend(n,t))},_clearChildSnapshots:function(){void 0!==this._childSnapshots&&(this._childSnapshots=void 0)}},n.mixins.Url={getUrlFromProps:function(t){return"?"+n.serialize.getQueryStringFromProps(t)},routeLink:function(t){t.preventDefault(),this.props.router.goTo(t.currentTarget.href)}};var r=t.addons.classSet;return n.components.ComponentPlayground=t.createClass({mixins:[n.mixins.ComponentTree,n.mixins.Url],displayName:"ComponentPlayground",propTypes:{fixtures:t.PropTypes.object.isRequired,fixturePath:t.PropTypes.string,fullScreen:t.PropTypes.bool,containerClassName:t.PropTypes.string},getInitialState:function(){var t=[];return this.props.fixturePath&&t.push(this._getComponentNameFromPath(this.props.fixturePath)),{expandedComponents:t}},children:{preview:function(){var t=this.props.fixturePath,n={component:this._getComponentNameFromPath(t),key:t};this.props.router&&(n.router=this.props.router);var r=this._getFixtureContentsFromPath(t);return e.merge(n,r)}},render:function(){var e=r({"component-playground":!0,"full-screen":this.props.fullScreen});return t.createElement("div",{className:e},t.createElement("div",{className:"header"},this.renderFullScreenButton(),t.createElement("h1",null,t.createElement("a",{href:"?",className:"home-link",onClick:this.routeLink},t.createElement("span",{className:"react"},"React")," Component Playground"),t.createElement("span",{className:"cosmos-plug"},"powered by ",t.createElement("a",{href:"https://github.com/skidding/cosmos"},"Cosmos")))),t.createElement("div",{className:"fixtures"},this.renderFixtures()),t.createElement("div",{ref:"preview",className:this._getPreviewClasses()},this.props.fixturePath?this.loadChild("preview"):null))},renderFixtures:function(){return t.createElement("ul",{className:"components"},e.map(this.props.fixtures,function(n,o){var i=r({component:!0,expanded:-1!==this.state.expandedComponents.indexOf(o)});return t.createElement("li",{className:i,key:o},t.createElement("p",{className:"component-name"},t.createElement("a",{href:"#toggle-component",onClick:e.partial(this.handleComponentClick,o),ref:o+"Button"},o)),this.renderComponentFixtures(o,n))}.bind(this)))},renderComponentFixtures:function(n,r){return t.createElement("ul",{className:"component-fixtures"},e.map(r,function(e,r){var o=this.getUrlFromProps({fixturePath:n+"/"+r});return t.createElement("li",{className:this._getFixtureClasses(r),key:r},t.createElement("a",{href:o,onClick:this.routeLink},r.replace(/-/g," ")))}.bind(this)))},renderFullScreenButton:function(){if(this.props.fixturePath){var e=this.getUrlFromProps({fixturePath:this.props.fixturePath,fullScreen:!0});return t.createElement("a",{href:e,className:"full-screen-button",ref:"fullScreenButton"},"Fullscreen")}},handleComponentClick:function(t,n){n.preventDefault();var r,o=this.state.expandedComponents,i=o.indexOf(t);-1!==i?(r=e.clone(o),r.splice(i,1)):r=o.concat(t),this.setState({expandedComponents:r})},_getPreviewClasses:function(){var t={preview:!0};return this.props.containerClassName&&(t[this.props.containerClassName]=!0),r(t)},_getFixtureClasses:function(t){var e={"component-fixture":!0},n=this.props.fixturePath;if(n){var o=this._getFixtureNameFromPath(n);e.selected=t===o}return r(e)},_getFixtureContentsFromPath:function(t){var e=this._getComponentNameFromPath(t),n=this._getFixtureNameFromPath(t);return this.props.fixtures[e][n]},_getComponentNameFromPath:function(t){return t.split("/")[0]},_getFixtureNameFromPath:function(t){return t.substr(t.indexOf("/")+1)}}),n});